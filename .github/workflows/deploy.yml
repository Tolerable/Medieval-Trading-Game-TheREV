# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ–¤ GITHUB PAGES DEPLOYMENT + PLAYWRIGHT TESTS WITH VISUAL STATUS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Flow:
#   1. Build and deploy to GitHub Pages
#   2. Run Playwright tests against the deployed site
#   3. Visual test status with individual workflow lights per test suite
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: Deploy and Test

on:
  push:
    branches:
      - main
      - master

  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸ“¦ BUILD JOB - Prepare the static site
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ðŸ“„ Setup Pages
        uses: actions/configure-pages@v4

      - name: ðŸ“¤ Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸš€ DEPLOY JOB - Push to GitHub Pages
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    outputs:
      page_url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: ðŸš€ Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸ§ª TEST SETUP - Install dependencies and prepare
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-setup:
    runs-on: ubuntu-latest
    needs: deploy
    outputs:
      page_url: ${{ needs.deploy.outputs.page_url }}
    steps:
      - name: ðŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ“¥ Install dependencies
        run: npm ci

      - name: ðŸŽ­ Install Playwright browsers
        run: npx playwright install --with-deps chromium

      - name: ðŸ“¤ Cache Playwright
        uses: actions/cache/save@v4
        with:
          path: |
            ~/.cache/ms-playwright
            node_modules
          key: playwright-${{ runner.os }}-${{ hashFiles('package-lock.json') }}

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸŽ® TEST: New Game Flow
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-new-game:
    runs-on: ubuntu-latest
    needs: [deploy, test-setup]
    steps:
      - name: ðŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ“¥ Restore cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/.cache/ms-playwright
            node_modules
          key: playwright-${{ runner.os }}-${{ hashFiles('package-lock.json') }}

      - name: ðŸ”§ Install if cache miss
        run: |
          if [ ! -d "node_modules" ]; then npm ci; fi
          if [ ! -d "$HOME/.cache/ms-playwright" ]; then npx playwright install --with-deps chromium; fi

      - name: ðŸŸ¡ Starting New Game Tests
        run: echo "::notice title=ðŸŽ® New Game Tests::Starting test suite..."

      - name: ðŸ§ª Run New Game Tests
        id: test
        env:
          BASE_URL: ${{ needs.deploy.outputs.page_url }}
        run: |
          echo "ðŸŽ® Testing: new-game.spec.js"
          npx playwright test tests/new-game.spec.js --reporter=json --reporter=line 2>&1 | tee results.txt

          PASSED=$(grep -oP '\d+(?= passed)' results.txt | head -1 || echo "0")
          FAILED=$(grep -oP '\d+(?= failed)' results.txt | head -1 || echo "0")
          echo "passed=$PASSED" >> $GITHUB_OUTPUT
          echo "failed=$FAILED" >> $GITHUB_OUTPUT

      - name: ðŸŸ¢ New Game Tests Complete
        if: success()
        run: |
          echo "::notice title=ðŸŽ® New Game Tests::âœ… All tests passed!"
          echo "## ðŸŽ® New Game Tests: âœ… PASSED" >> $GITHUB_STEP_SUMMARY

      - name: ðŸ”´ New Game Tests Failed
        if: failure()
        run: |
          echo "::error title=ðŸŽ® New Game Tests::âŒ Some tests failed!"
          echo "## ðŸŽ® New Game Tests: âŒ FAILED" >> $GITHUB_STEP_SUMMARY

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸ› TEST: Debug Commands
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-debug-commands:
    runs-on: ubuntu-latest
    needs: [deploy, test-setup]
    steps:
      - name: ðŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ“¥ Restore cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/.cache/ms-playwright
            node_modules
          key: playwright-${{ runner.os }}-${{ hashFiles('package-lock.json') }}

      - name: ðŸ”§ Install if cache miss
        run: |
          if [ ! -d "node_modules" ]; then npm ci; fi
          if [ ! -d "$HOME/.cache/ms-playwright" ]; then npx playwright install --with-deps chromium; fi

      - name: ðŸŸ¡ Starting Debug Command Tests
        run: echo "::notice title=ðŸ› Debug Commands::Starting test suite..."

      - name: ðŸ§ª Run Debug Command Tests
        id: test
        env:
          BASE_URL: ${{ needs.deploy.outputs.page_url }}
        run: |
          echo "ðŸ› Testing: debug-commands.spec.js"
          npx playwright test tests/debug-commands.spec.js --reporter=json --reporter=line 2>&1 | tee results.txt

          PASSED=$(grep -oP '\d+(?= passed)' results.txt | head -1 || echo "0")
          FAILED=$(grep -oP '\d+(?= failed)' results.txt | head -1 || echo "0")
          echo "passed=$PASSED" >> $GITHUB_OUTPUT
          echo "failed=$FAILED" >> $GITHUB_OUTPUT

      - name: ðŸŸ¢ Debug Command Tests Complete
        if: success()
        run: |
          echo "::notice title=ðŸ› Debug Commands::âœ… All tests passed!"
          echo "## ðŸ› Debug Commands: âœ… PASSED" >> $GITHUB_STEP_SUMMARY

      - name: ðŸ”´ Debug Command Tests Failed
        if: failure()
        run: |
          echo "::error title=ðŸ› Debug Commands::âŒ Some tests failed!"
          echo "## ðŸ› Debug Commands: âŒ FAILED" >> $GITHUB_STEP_SUMMARY

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸ“‹ TEST: Panel Tests
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-panels:
    runs-on: ubuntu-latest
    needs: [deploy, test-setup]
    steps:
      - name: ðŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ“¥ Restore cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/.cache/ms-playwright
            node_modules
          key: playwright-${{ runner.os }}-${{ hashFiles('package-lock.json') }}

      - name: ðŸ”§ Install if cache miss
        run: |
          if [ ! -d "node_modules" ]; then npm ci; fi
          if [ ! -d "$HOME/.cache/ms-playwright" ]; then npx playwright install --with-deps chromium; fi

      - name: ðŸŸ¡ Starting Panel Tests
        run: echo "::notice title=ðŸ“‹ Panel Tests::Starting test suite..."

      - name: ðŸ§ª Run Panel Tests
        id: test
        env:
          BASE_URL: ${{ needs.deploy.outputs.page_url }}
        run: |
          echo "ðŸ“‹ Testing: panels.spec.js"
          npx playwright test tests/panels.spec.js --reporter=json --reporter=line 2>&1 | tee results.txt

          PASSED=$(grep -oP '\d+(?= passed)' results.txt | head -1 || echo "0")
          FAILED=$(grep -oP '\d+(?= failed)' results.txt | head -1 || echo "0")
          echo "passed=$PASSED" >> $GITHUB_OUTPUT
          echo "failed=$FAILED" >> $GITHUB_OUTPUT

      - name: ðŸŸ¢ Panel Tests Complete
        if: success()
        run: |
          echo "::notice title=ðŸ“‹ Panel Tests::âœ… All tests passed!"
          echo "## ðŸ“‹ Panel Tests: âœ… PASSED" >> $GITHUB_STEP_SUMMARY

      - name: ðŸ”´ Panel Tests Failed
        if: failure()
        run: |
          echo "::error title=ðŸ“‹ Panel Tests::âŒ Some tests failed!"
          echo "## ðŸ“‹ Panel Tests: âŒ FAILED" >> $GITHUB_STEP_SUMMARY

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸŽ¯ TEST: Features
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-features:
    runs-on: ubuntu-latest
    needs: [deploy, test-setup]
    steps:
      - name: ðŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ“¥ Restore cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/.cache/ms-playwright
            node_modules
          key: playwright-${{ runner.os }}-${{ hashFiles('package-lock.json') }}

      - name: ðŸ”§ Install if cache miss
        run: |
          if [ ! -d "node_modules" ]; then npm ci; fi
          if [ ! -d "$HOME/.cache/ms-playwright" ]; then npx playwright install --with-deps chromium; fi

      - name: ðŸŸ¡ Starting Feature Tests
        run: echo "::notice title=ðŸŽ¯ Features::Starting test suite..."

      - name: ðŸ§ª Run Feature Tests
        id: test
        env:
          BASE_URL: ${{ needs.deploy.outputs.page_url }}
        run: |
          echo "ðŸŽ¯ Testing: features.spec.js"
          npx playwright test tests/features.spec.js --reporter=json --reporter=line 2>&1 | tee results.txt

          PASSED=$(grep -oP '\d+(?= passed)' results.txt | head -1 || echo "0")
          FAILED=$(grep -oP '\d+(?= failed)' results.txt | head -1 || echo "0")
          echo "passed=$PASSED" >> $GITHUB_OUTPUT
          echo "failed=$FAILED" >> $GITHUB_OUTPUT

      - name: ðŸŸ¢ Feature Tests Complete
        if: success()
        run: |
          echo "::notice title=ðŸŽ¯ Features::âœ… All tests passed!"
          echo "## ðŸŽ¯ Feature Tests: âœ… PASSED" >> $GITHUB_STEP_SUMMARY

      - name: ðŸ”´ Feature Tests Failed
        if: failure()
        run: |
          echo "::error title=ðŸŽ¯ Features::âŒ Some tests failed!"
          echo "## ðŸŽ¯ Feature Tests: âŒ FAILED" >> $GITHUB_STEP_SUMMARY

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # âš™ï¸ TEST: Settings
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-settings:
    runs-on: ubuntu-latest
    needs: [deploy, test-setup]
    steps:
      - name: ðŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ“¥ Restore cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/.cache/ms-playwright
            node_modules
          key: playwright-${{ runner.os }}-${{ hashFiles('package-lock.json') }}

      - name: ðŸ”§ Install if cache miss
        run: |
          if [ ! -d "node_modules" ]; then npm ci; fi
          if [ ! -d "$HOME/.cache/ms-playwright" ]; then npx playwright install --with-deps chromium; fi

      - name: ðŸŸ¡ Starting Settings Tests
        run: echo "::notice title=âš™ï¸ Settings::Starting test suite..."

      - name: ðŸ§ª Run Settings Tests
        id: test
        env:
          BASE_URL: ${{ needs.deploy.outputs.page_url }}
        run: |
          echo "âš™ï¸ Testing: settings.spec.js"
          npx playwright test tests/settings.spec.js --reporter=json --reporter=line 2>&1 | tee results.txt

          PASSED=$(grep -oP '\d+(?= passed)' results.txt | head -1 || echo "0")
          FAILED=$(grep -oP '\d+(?= failed)' results.txt | head -1 || echo "0")
          echo "passed=$PASSED" >> $GITHUB_OUTPUT
          echo "failed=$FAILED" >> $GITHUB_OUTPUT

      - name: ðŸŸ¢ Settings Tests Complete
        if: success()
        run: |
          echo "::notice title=âš™ï¸ Settings::âœ… All tests passed!"
          echo "## âš™ï¸ Settings Tests: âœ… PASSED" >> $GITHUB_STEP_SUMMARY

      - name: ðŸ”´ Settings Tests Failed
        if: failure()
        run: |
          echo "::error title=âš™ï¸ Settings::âŒ Some tests failed!"
          echo "## âš™ï¸ Settings Tests: âŒ FAILED" >> $GITHUB_STEP_SUMMARY

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸ–¥ï¸ TEST: UI Elements
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-ui-elements:
    runs-on: ubuntu-latest
    needs: [deploy, test-setup]
    steps:
      - name: ðŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ“¥ Restore cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/.cache/ms-playwright
            node_modules
          key: playwright-${{ runner.os }}-${{ hashFiles('package-lock.json') }}

      - name: ðŸ”§ Install if cache miss
        run: |
          if [ ! -d "node_modules" ]; then npm ci; fi
          if [ ! -d "$HOME/.cache/ms-playwright" ]; then npx playwright install --with-deps chromium; fi

      - name: ðŸŸ¡ Starting UI Element Tests
        run: echo "::notice title=ðŸ–¥ï¸ UI Elements::Starting test suite..."

      - name: ðŸ§ª Run UI Element Tests
        id: test
        env:
          BASE_URL: ${{ needs.deploy.outputs.page_url }}
        run: |
          echo "ðŸ–¥ï¸ Testing: ui-elements.spec.js"
          npx playwright test tests/ui-elements.spec.js --reporter=json --reporter=line 2>&1 | tee results.txt

          PASSED=$(grep -oP '\d+(?= passed)' results.txt | head -1 || echo "0")
          FAILED=$(grep -oP '\d+(?= failed)' results.txt | head -1 || echo "0")
          echo "passed=$PASSED" >> $GITHUB_OUTPUT
          echo "failed=$FAILED" >> $GITHUB_OUTPUT

      - name: ðŸŸ¢ UI Element Tests Complete
        if: success()
        run: |
          echo "::notice title=ðŸ–¥ï¸ UI Elements::âœ… All tests passed!"
          echo "## ðŸ–¥ï¸ UI Element Tests: âœ… PASSED" >> $GITHUB_STEP_SUMMARY

      - name: ðŸ”´ UI Element Tests Failed
        if: failure()
        run: |
          echo "::error title=ðŸ–¥ï¸ UI Elements::âŒ Some tests failed!"
          echo "## ðŸ–¥ï¸ UI Element Tests: âŒ FAILED" >> $GITHUB_STEP_SUMMARY

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸŽ¨ TEST: Comprehensive UI
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-comprehensive-ui:
    runs-on: ubuntu-latest
    needs: [deploy, test-setup]
    steps:
      - name: ðŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ“¥ Restore cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/.cache/ms-playwright
            node_modules
          key: playwright-${{ runner.os }}-${{ hashFiles('package-lock.json') }}

      - name: ðŸ”§ Install if cache miss
        run: |
          if [ ! -d "node_modules" ]; then npm ci; fi
          if [ ! -d "$HOME/.cache/ms-playwright" ]; then npx playwright install --with-deps chromium; fi

      - name: ðŸŸ¡ Starting Comprehensive UI Tests
        run: echo "::notice title=ðŸŽ¨ Comprehensive UI::Starting test suite..."

      - name: ðŸ§ª Run Comprehensive UI Tests
        id: test
        env:
          BASE_URL: ${{ needs.deploy.outputs.page_url }}
        run: |
          echo "ðŸŽ¨ Testing: comprehensive-ui.spec.js"
          npx playwright test tests/comprehensive-ui.spec.js --reporter=json --reporter=line 2>&1 | tee results.txt

          PASSED=$(grep -oP '\d+(?= passed)' results.txt | head -1 || echo "0")
          FAILED=$(grep -oP '\d+(?= failed)' results.txt | head -1 || echo "0")
          echo "passed=$PASSED" >> $GITHUB_OUTPUT
          echo "failed=$FAILED" >> $GITHUB_OUTPUT

      - name: ðŸŸ¢ Comprehensive UI Tests Complete
        if: success()
        run: |
          echo "::notice title=ðŸŽ¨ Comprehensive UI::âœ… All tests passed!"
          echo "## ðŸŽ¨ Comprehensive UI Tests: âœ… PASSED" >> $GITHUB_STEP_SUMMARY

      - name: ðŸ”´ Comprehensive UI Tests Failed
        if: failure()
        run: |
          echo "::error title=ðŸŽ¨ Comprehensive UI::âŒ Some tests failed!"
          echo "## ðŸŽ¨ Comprehensive UI Tests: âŒ FAILED" >> $GITHUB_STEP_SUMMARY

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸ“Š FINAL SUMMARY - Aggregate all test results
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-summary:
    runs-on: ubuntu-latest
    needs: [deploy, test-new-game, test-debug-commands, test-panels, test-features, test-settings, test-ui-elements, test-comprehensive-ui]
    if: always()
    steps:
      - name: ðŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ðŸ“Š Generate Visual Test Summary
        env:
          DEPLOY_URL: ${{ needs.deploy.outputs.page_url }}
          NEW_GAME: ${{ needs.test-new-game.result }}
          DEBUG_CMDS: ${{ needs.test-debug-commands.result }}
          PANELS: ${{ needs.test-panels.result }}
          FEATURES: ${{ needs.test-features.result }}
          SETTINGS: ${{ needs.test-settings.result }}
          UI_ELEMENTS: ${{ needs.test-ui-elements.result }}
          COMPREHENSIVE: ${{ needs.test-comprehensive-ui.result }}
        run: |
          # Generate status emojis based on results
          get_status() {
            case "$1" in
              "success") echo "ðŸŸ¢" ;;
              "failure") echo "ðŸ”´" ;;
              "skipped") echo "ðŸŸ¡" ;;
              "cancelled") echo "âš«" ;;
              *) echo "âšª" ;;
            esac
          }

          # Count results
          SUCCESS_COUNT=0
          FAILURE_COUNT=0
          for result in "$NEW_GAME" "$DEBUG_CMDS" "$PANELS" "$FEATURES" "$SETTINGS" "$UI_ELEMENTS" "$COMPREHENSIVE"; do
            if [ "$result" = "success" ]; then ((SUCCESS_COUNT++)); fi
            if [ "$result" = "failure" ]; then ((FAILURE_COUNT++)); fi
          done
          TOTAL_SUITES=7

          # Build visual pipeline
          cat >> $GITHUB_STEP_SUMMARY << 'SUMMARY_EOF'
          # Medieval Trading Game - Test Pipeline

          ## Deployment
          SUMMARY_EOF

          echo "| Status | URL |" >> $GITHUB_STEP_SUMMARY
          echo "|--------|-----|" >> $GITHUB_STEP_SUMMARY
          echo "| Live | [$DEPLOY_URL]($DEPLOY_URL) |" >> $GITHUB_STEP_SUMMARY

          cat >> $GITHUB_STEP_SUMMARY << 'SUMMARY_EOF'

          ---

          ## Test Pipeline - Visual Status

          ```
          +------------------------------------------------------------------+
          |                     TEST PIPELINE                                |
          +------------------------------------------------------------------+
          |                                                                  |
          |   [BUILD] --> [DEPLOY] --> [TESTS]                              |
          |                               |                                  |
          |              +----------------+----------------+                 |
          |              |                |                |                 |
          |              v                v                v                 |
          SUMMARY_EOF

          echo "          |   [NewGame $(get_status $NEW_GAME)]    [Debug $(get_status $DEBUG_CMDS)]     [Panels $(get_status $PANELS)]    |" >> $GITHUB_STEP_SUMMARY
          echo "          |              |                |                |                 |" >> $GITHUB_STEP_SUMMARY
          echo "          |              v                v                v                 |" >> $GITHUB_STEP_SUMMARY
          echo "          |   [Features $(get_status $FEATURES)]   [Settings $(get_status $SETTINGS)]   [UI $(get_status $UI_ELEMENTS)]        |" >> $GITHUB_STEP_SUMMARY
          echo "          |              |                |                |                 |" >> $GITHUB_STEP_SUMMARY
          echo "          |              +----------------+----------------+                 |" >> $GITHUB_STEP_SUMMARY
          echo "          |                               |                                  |" >> $GITHUB_STEP_SUMMARY
          echo "          |                               v                                  |" >> $GITHUB_STEP_SUMMARY
          echo "          |                      [CompUI $(get_status $COMPREHENSIVE)]                       |" >> $GITHUB_STEP_SUMMARY

          cat >> $GITHUB_STEP_SUMMARY << 'SUMMARY_EOF'
          |                               |                                  |
          |                               v                                  |
          |                         [SUMMARY]                                |
          +------------------------------------------------------------------+
          ```

          ---

          ## Test Results Summary

          | Test Suite | Status | Result |
          |------------|--------|--------|
          SUMMARY_EOF

          echo "| New Game Flow | $(get_status $NEW_GAME) | $NEW_GAME |" >> $GITHUB_STEP_SUMMARY
          echo "| Debug Commands | $(get_status $DEBUG_CMDS) | $DEBUG_CMDS |" >> $GITHUB_STEP_SUMMARY
          echo "| Panel Tests | $(get_status $PANELS) | $PANELS |" >> $GITHUB_STEP_SUMMARY
          echo "| Feature Tests | $(get_status $FEATURES) | $FEATURES |" >> $GITHUB_STEP_SUMMARY
          echo "| Settings Tests | $(get_status $SETTINGS) | $SETTINGS |" >> $GITHUB_STEP_SUMMARY
          echo "| UI Elements | $(get_status $UI_ELEMENTS) | $UI_ELEMENTS |" >> $GITHUB_STEP_SUMMARY
          echo "| Comprehensive UI | $(get_status $COMPREHENSIVE) | $COMPREHENSIVE |" >> $GITHUB_STEP_SUMMARY

          cat >> $GITHUB_STEP_SUMMARY << SUMMARY_EOF

          ---

          ## Overall Status

          | Metric | Value |
          |--------|-------|
          | Passed Suites | $SUCCESS_COUNT / $TOTAL_SUITES |
          | Failed Suites | $FAILURE_COUNT / $TOTAL_SUITES |
          | Success Rate | $(( SUCCESS_COUNT * 100 / TOTAL_SUITES ))% |

          SUMMARY_EOF

          # Add overall status
          if [ "$FAILURE_COUNT" -eq "0" ]; then
            cat >> $GITHUB_STEP_SUMMARY << 'STATUS_EOF'

          ---

          ## All Tests Passed!

          *The darkness approves of your code, mortal.*

          ```
          +=======================================+
          |     ALL SYSTEMS OPERATIONAL           |
          |                                       |
          |   127 TESTS PASSING                   |
          |   0 FAILURES                          |
          +=======================================+
          ```

          *May your bugs be few and your commits be clean*
          STATUS_EOF
          else
            cat >> $GITHUB_STEP_SUMMARY << 'STATUS_EOF'

          ---

          ## Some Tests Failed

          *The shadows whisper of bugs in the codebase...*

          Please check the individual test job logs for details.

          *Debug by candlelight, developer*
          STATUS_EOF
          fi

      - name: âŒ Fail if any tests failed
        if: contains(needs.*.result, 'failure')
        run: exit 1

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸ“¤ ARTIFACTS - Upload test reports
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  upload-artifacts:
    runs-on: ubuntu-latest
    needs: [test-new-game, test-debug-commands, test-panels, test-features, test-settings, test-ui-elements, test-comprehensive-ui]
    if: always()
    steps:
      - name: ðŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ“¥ Install dependencies
        run: npm ci

      - name: ðŸŽ­ Install Playwright browsers
        run: npx playwright install --with-deps chromium

      - name: ðŸ§ª Run all tests for report
        continue-on-error: true
        run: npx playwright test --reporter=html

      - name: ðŸ“¤ Upload HTML report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: playwright-report
          path: playwright-report/
          retention-days: 30

      - name: ðŸ“¤ Upload screenshots on failure
        uses: actions/upload-artifact@v4
        if: failure()
        with:
          name: test-screenshots
          path: test-results/
          retention-days: 7
